<script>
    const response = { status: "success" };
    
    if (window.performance) {
        const perf = window.performance;
        const timing = perf.timing;
        
        response.metrics = {
            navigationStart: timing.navigationStart,
            loadEventEnd: timing.loadEventEnd,
            domLoading: timing.domLoading,
            domInteractive: timing.domInteractive,
            domContentLoaded: timing.domContentLoadedEventEnd,
            domComplete: timing.domComplete,
            pageLoadTime: timing.loadEventEnd - timing.navigationStart,
            dnsLookup: timing.domainLookupEnd - timing.domainLookupStart,
            tcpConnect: timing.connectEnd - timing.connectStart,
            requestResponse: timing.responseEnd - timing.requestStart,
            firstPaint: perf.getEntriesByName('first-paint')[0]?.startTime,
            firstContentfulPaint: perf.getEntriesByName('first-contentful-paint')[0]?.startTime
        };
        
        // 获取资源加载性能数据
        response.resources = perf.getEntriesByType('resource').map(resource => ({
            name: resource.name,
            duration: resource.duration,
            transferSize: resource.transferSize,
            initiatorType: resource.initiatorType
        }));
    } else {
        response.status = "error";
        response.message = "Performance API不可用";
    }
    
    document.write(JSON.stringify(response));
</script>
